<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨è‡ªåŠ¨ç¾¤ç»„é“¾æ¥æ£€æµ‹ç³»ç»Ÿ - å¢å¼ºç‰ˆ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- å¼•å…¥Tesseract.jsç”¨äºOCRè¯†åˆ« -->
    <script src="https://unpkg.com/tesseract.js@v2.1.5/dist/tesseract.min.js"></script>
    <!-- å¼•å…¥html2canvasç”¨äºæˆªå›¾ -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <!-- å¼•å…¥FileSaver.jsç”¨äºæ–‡ä»¶ä¿å­˜ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        /* ä¿æŒåŸæœ‰çš„æ‰€æœ‰æ ·å¼ä¸å˜ */
        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --light: #f8f9fa;
            --dark: #1f2937;
            --telegram: #0088cc;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .app-container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            min-height: calc(100vh - 40px);
            display: flex;
            flex-direction: column;
        }
        
        /* å¤´éƒ¨æ ·å¼ */
        .app-header {
            background: white;
            padding: 25px 30px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-left h1 {
            font-size: 1.8rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 5px;
        }
        
        .header-left p {
            color: #666;
            font-size: 0.95rem;
        }
        
        .header-right {
            display: flex;
            gap: 10px;
        }
        
        /* æ ‡ç­¾é¡µ */
        .tabs {
            display: flex;
            background: var(--light);
            border-bottom: 1px solid #e5e7eb;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 15px 30px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
            position: relative;
            white-space: nowrap;
        }
        
        .tab:hover {
            color: var(--primary);
            background: rgba(102, 126, 234, 0.1);
        }
        
        .tab.active {
            color: var(--primary);
            background: white;
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
        }
        
        /* ä¸»å†…å®¹åŒº */
        .main-content {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
            background: #f9fafb;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* å¡ç‰‡æ ·å¼ */
        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border: 1px solid #e5e7eb;
            margin-bottom: 25px;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light);
        }
        
        .card-title {
            font-size: 1.25rem;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* æŒ‰é’®æ ·å¼ */
        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-telegram {
            background: var(--telegram);
            color: white;
        }
        
        .btn-warning {
            background: var(--warning);
            color: white;
        }
        
        .btn-info {
            background: var(--info);
            color: white;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }
        
        .btn-block {
            width: 100%;
            justify-content: center;
        }
        
        /* ç¾¤ç»„å¡ç‰‡ */
        .groups-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .group-card {
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
            background: white;
        }
        
        .group-card.active {
            border-color: var(--telegram);
            background: linear-gradient(to right, rgba(0, 136, 204, 0.05), transparent);
        }
        
        .group-card.matched {
            border-color: var(--success);
            background: linear-gradient(to right, rgba(16, 185, 129, 0.05), transparent);
        }
        
        .group-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .group-name {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .group-website {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 10px;
            word-break: break-all;
            background: #f8f9fa;
            padding: 8px 12px;
            border-radius: 6px;
            border-left: 3px solid var(--primary);
        }
        
        /* å†…åµŒæµè§ˆå™¨ */
        .browser-container {
            width: 100%;
            margin-top: 15px;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid #e5e7eb;
            display: none;
            flex-direction: column;
            max-height: 600px;
        }
        
        .browser-container.active {
            display: flex;
            animation: slideDown 0.3s ease-out;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
                max-height: 0;
            }
            to {
                opacity: 1;
                transform: translateY(0);
                max-height: 600px;
            }
        }
        
        .browser-header {
            background: var(--light);
            padding: 10px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .browser-url {
            flex: 1;
            padding: 6px 12px;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 0.85rem;
            font-family: 'Courier New', monospace;
        }
        
        .browser-frame {
            width: 100%;
            height: 500px;
            border: none;
            background: white;
            flex: 1;
        }
        
        /* å†…åµŒæµè§ˆå™¨çŠ¶æ€ */
        .browser-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .browser-status.loading {
            background: #fef3c7;
            color: #d97706;
        }
        
        .browser-status.ready {
            background: #d1fae5;
            color: #065f46;
        }
        
        .browser-status.error {
            background: #fee2e2;
            color: #991b1b;
        }
        
        /* è‡ªåŠ¨åŒ–æ£€æµ‹æ§åˆ¶ */
        .auto-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #e5e7eb;
        }
        
        /* é“¾æ¥è¾“å…¥åŒº */
        .batch-links-input {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
            margin-top: 10px;
        }
        
        .batch-links-input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        /* çŠ¶æ€æ ‡ç­¾ */
        .status-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
        }
        
        .status-pending { background: #fef3c7; color: #d97706; }
        .status-checking { background: #dbeafe; color: #1d4ed8; }
        .status-success { background: #d1fae5; color: #065f46; }
        .status-error { background: #fee2e2; color: #991b1b; }
        .status-matched { background: #d1fae5; color: #065f46; }
        .status-no_match { background: #fee2e2; color: #991b1b; }
        .status-sending { background: #dbeafe; color: #1d4ed8; }
        .status-sent { background: #d1fae5; color: #065f46; }
        .status-automatic { background: #8b5cf6; color: white; }
        
        /* æ£€æµ‹è¿›åº¦ */
        .detection-progress {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #e5e7eb;
        }
        
        .progress-steps {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            position: relative;
        }
        
        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 2;
        }
        
        .step-dot {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #e5e7eb;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .step-dot.active {
            background: var(--primary);
            color: white;
        }
        
        .step-dot.completed {
            background: var(--success);
            color: white;
        }
        
        .step-label {
            font-size: 0.8rem;
            color: #666;
            text-align: center;
        }
        
        .progress-line {
            position: absolute;
            top: 15px;
            left: 50px;
            right: 50px;
            height: 2px;
            background: #e5e7eb;
            z-index: 1;
        }
        
        /* é“¾æ¥åˆ—è¡¨ */
        .links-container {
            margin: 15px 0;
        }
        
        .link-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            margin-bottom: 8px;
            border: 1px solid #e5e7eb;
        }
        
        .link-item.matched {
            background: #d1fae5;
            border-color: var(--success);
        }
        
        .link-text {
            flex: 1;
            word-break: break-all;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
        }
        
        /* æ£€æµ‹ç»“æœ */
        .results-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .result-card {
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            background: white;
        }
        
        .result-card.success {
            border-color: var(--success);
            background: linear-gradient(to right, rgba(16, 185, 129, 0.05), transparent);
        }
        
        .result-card.error {
            border-color: var(--danger);
            background: linear-gradient(to right, rgba(239, 68, 68, 0.05), transparent);
        }
        
        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border: 1px solid #e5e7eb;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }
        
        /* å¯¼å…¥å¯¼å‡ºåŒºåŸŸ */
        .import-export-area {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 2px dashed #e5e7eb;
            margin: 20px 0;
        }
        
        .import-export-controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
            flex: 1;
            min-width: 200px;
        }
        
        .file-input-wrapper input[type=file] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .file-input-btn {
            display: inline-block;
            width: 100%;
            padding: 12px 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .file-input-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        /* å®æ—¶çŠ¶æ€æ˜¾ç¤º */
        .real-time-status {
            background: white;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #e5e7eb;
            margin: 15px 0;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .status-item:last-child {
            border-bottom: none;
        }
        
        /* æ—¥å¿—æ˜¾ç¤º */
        .log-container {
            max-height: 200px;
            overflow-y: auto;
            background: #1f2937;
            color: #10b981;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin-top: 15px;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding-bottom: 5px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .log-time {
            color: #9ca3af;
            margin-right: 10px;
        }
        
        .log-info { color: #3b82f6; }
        .log-success { color: #10b981; }
        .log-warning { color: #f59e0b; }
        .log-error { color: #ef4444; }
        
        /* æ­¥éª¤æŒ‡ç¤ºå™¨ */
        .step-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
            padding: 8px 12px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid var(--primary);
        }
        
        .step-indicator.active {
            background: #e8f4ff;
            border-left-color: var(--info);
        }
        
        .step-indicator.completed {
            background: #f0fff4;
            border-left-color: var(--success);
        }
        
        .step-indicator i {
            width: 20px;
        }
        
        /* æµè§ˆå™¨åŠ è½½æŒ‡ç¤ºå™¨ */
        .browser-loading {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 10;
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .browser-loading.active {
            display: block;
        }
        
        .browser-frame-wrapper {
            position: relative;
            height: 500px;
        }
        
        /* ç»“æœé¢„è§ˆ */
        .result-preview {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #e5e7eb;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }
        
        /* æ¨¡æ€æ¡† */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 1.3rem;
            color: var(--dark);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        
        .form-input {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        /* é€šçŸ¥æ ·å¼ */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 1001;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            animation: slideIn 0.3s ease-out;
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 400px;
        }
        
        .notification.success {
            background: var(--success);
        }
        
        .notification.error {
            background: var(--danger);
        }
        
        .notification.warning {
            background: var(--warning);
        }
        
        .notification.info {
            background: var(--info);
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: none;
            text-align: center;
            padding: 30px;
        }
        
        .loading.active {
            display: block;
        }
        
        .spinner {
            border: 3px solid rgba(0, 0, 0, 0.1);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border-left-color: var(--primary);
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* å·¥å…·ç±» */
        .mt-10 { margin-top: 10px; }
        .mt-15 { margin-top: 15px; }
        .mt-20 { margin-top: 20px; }
        .mb-10 { margin-bottom: 10px; }
        .mb-15 { margin-bottom: 15px; }
        .mb-20 { margin-bottom: 20px; }
        .py-20 { padding: 20px 0; }
        .py-40 { padding: 40px 0; }
        .text-center { text-align: center; }
        .text-muted { color: #666; }
        .d-flex { display: flex; }
        .align-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-10 { gap: 10px; }
        
        /* é¡µè„š */
        .app-footer {
            padding: 15px 30px;
            border-top: 1px solid #e5e7eb;
            text-align: center;
            color: #666;
            font-size: 0.85rem;
            background: white;
        }
        
        /* æ–°å¢æ ·å¼ */
        .ocr-result {
            background: #1a202c;
            color: #63b3ed;
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .ocr-success {
            border-left: 4px solid #10b981;
            background: linear-gradient(to right, rgba(16, 185, 129, 0.1), transparent);
        }
        
        .ocr-failed {
            border-left: 4px solid #ef4444;
            background: linear-gradient(to right, rgba(239, 68, 68, 0.1), transparent);
        }
        
        .ocr-loading {
            border-left: 4px solid #f59e0b;
            background: linear-gradient(to right, rgba(245, 158, 11, 0.1), transparent);
        }
        
        .screenshot-preview {
            max-width: 300px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            margin: 10px 0;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .screenshot-preview:hover {
            transform: scale(1.02);
            border-color: #667eea;
        }
        
        .telegram-result {
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            font-size: 14px;
        }
        
        .telegram-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }
        
        .telegram-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }
        
        .logo-highlight {
            position: absolute;
            border: 3px solid #10b981;
            border-radius: 4px;
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.5);
            pointer-events: none;
            z-index: 999999;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 5px rgba(16, 185, 129, 0.5); }
            50% { box-shadow: 0 0 20px rgba(16, 185, 129, 0.8); }
            100% { box-shadow: 0 0 5px rgba(16, 185, 129, 0.5); }
        }
        
        /* ä»£ç†æµè§ˆå™¨æ ·å¼ */
        .proxy-browser {
            border: 2px solid #667eea;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .proxy-url {
            width: 100%;
            padding: 8px 12px;
            background: #f8f9fa;
            border-bottom: 1px solid #e5e7eb;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #666;
        }
        
        .proxy-actions {
            padding: 10px;
            background: #f0f2f5;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .action-step {
            background: white;
            padding: 8px 12px;
            border-radius: 6px;
            margin: 5px 0;
            border-left: 3px solid #3b82f6;
            font-size: 12px;
        }
        
        .action-step.success {
            border-left-color: #10b981;
            background: #f0fdf4;
        }
        
        .action-step.error {
            border-left-color: #ef4444;
            background: #fef2f2;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="app-header">
            <div class="header-left">
                <h1><i class="fab fa-telegram"></i> å…¨è‡ªåŠ¨ç¾¤ç»„é“¾æ¥æ£€æµ‹ç³»ç»Ÿ - å¢å¼ºç‰ˆ</h1>
                <p>çœŸå®å¯ç”¨ç‰ˆæœ¬ - ä»£ç†æµè§ˆå™¨è‡ªåŠ¨åŒ– + OCRè¯†åˆ«Logo + çœŸå®æˆªå›¾å‘é€</p>
            </div>
            <div class="header-right">
                <button class="btn btn-telegram" onclick="openBotConfig()">
                    <i class="fas fa-robot"></i> æœºå™¨äººé…ç½®
                </button>
                <button class="btn btn-success" onclick="startAllAutoDetection()">
                    <i class="fas fa-robot"></i> å¯åŠ¨å…¨è‡ªåŠ¨
                </button>
                <button class="btn btn-danger" onclick="stopAllAutoDetection()">
                    <i class="fas fa-stop"></i> åœæ­¢æ‰€æœ‰
                </button>
            </div>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab('groups')"><i class="fas fa-users"></i> ç¾¤ç»„ç®¡ç†</button>
            <button class="tab" onclick="switchTab('detection')"><i class="fas fa-search"></i> æ‰¹é‡é“¾æ¥æ£€æµ‹</button>
            <button class="tab" onclick="switchTab('automation')"><i class="fas fa-robot"></i> è‡ªåŠ¨åŒ–æ£€æµ‹</button>
            <button class="tab" onclick="switchTab('import-export')"><i class="fas fa-file-import"></i> å¯¼å…¥/å¯¼å‡º</button>
            <button class="tab" onclick="switchTab('results')"><i class="fas fa-chart-bar"></i> æ£€æµ‹ç»“æœ</button>
        </div>
        
        <div class="main-content">
            <!-- ç¾¤ç»„ç®¡ç†æ ‡ç­¾é¡µ -->
            <div id="tab-groups" class="tab-content active">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-users"></i> ç¾¤ç»„é…ç½®ç®¡ç†</h3>
                        <div class="d-flex gap-10">
                            <button class="btn btn-primary" onclick="openAddGroupModal()">
                                <i class="fas fa-plus"></i> æ·»åŠ æ–°ç¾¤ç»„
                            </button>
                            <button class="btn btn-info" onclick="exportGroupsToFile()">
                                <i class="fas fa-download"></i> å¯¼å‡ºé…ç½®
                            </button>
                        </div>
                    </div>
                    
                    <div class="import-export-area" style="margin-top: 20px;" id="importArea">
                        <h4><i class="fas fa-file-import"></i> å¯¼å…¥ç¾¤ç»„é…ç½®</h4>
                        <p class="text-muted mb-10">æ”¯æŒJSONæ ¼å¼çš„ç¾¤ç»„é…ç½®æ–‡ä»¶</p>
                        <div class="import-export-controls">
                            <div class="file-input-wrapper">
                                <button class="file-input-btn">
                                    <i class="fas fa-upload"></i> é€‰æ‹©JSONæ–‡ä»¶
                                </button>
                                <input type="file" id="importFile" accept=".json" onchange="importGroupsFromFile(this)">
                            </div>
                            <button class="btn btn-secondary" onclick="loadExampleGroups()">
                                <i class="fas fa-file-alt"></i> åŠ è½½ç¤ºä¾‹é…ç½®
                            </button>
                            <button class="btn btn-danger" onclick="clearAllGroups()">
                                <i class="fas fa-trash"></i> æ¸…ç©ºæ‰€æœ‰
                            </button>
                        </div>
                        <div id="importPreview" class="result-preview" style="display: none;"></div>
                    </div>
                    
                    <div class="groups-container" id="groupsContainer">
                        <!-- ç¾¤ç»„å¡ç‰‡ä¼šåŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
                    </div>
                </div>
            </div>
            
            <!-- æ‰¹é‡é“¾æ¥æ£€æµ‹æ ‡ç­¾é¡µ -->
            <div id="tab-detection" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-link"></i> æ‰¹é‡é“¾æ¥æ£€æµ‹ï¼ˆå®Œæ•´é“¾æ¥æ£€æµ‹ï¼‰</h3>
                        <div class="d-flex gap-10">
                            <button class="btn btn-success" onclick="startMultiCheck()">
                                <i class="fas fa-play"></i> å¼€å§‹æ£€æµ‹
                            </button>
                            <button class="btn btn-danger" onclick="stopAllChecks()" id="stopBtn">
                                <i class="fas fa-stop"></i> åœæ­¢
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group mb-20">
                        <label class="form-label">
                            <i class="fas fa-list"></i> æ‰¹é‡è¾“å…¥å¾…æ£€æµ‹é“¾æ¥ï¼ˆæ¯è¡Œä¸€ä¸ªå®Œæ•´é“¾æ¥ï¼‰
                        </label>
                        <textarea id="batchLinksInput" class="batch-links-input" placeholder="ç¤ºä¾‹å®Œæ•´é“¾æ¥ï¼š
https://shop.example.com/product?cid=7890&ref=test
https://shop.example.com/item?cid=7890&size=large
https://api.example.com/product?cid=1234&color=red
https://api.example.com/item?cid=5678&ref=promo
https://example.com/join?cid=7890&token=abc123
https://test.com/group?cid=1234&user=test#section

# ç³»ç»Ÿå°†ä½¿ç”¨å®Œæ•´é“¾æ¥è¿›è¡Œæ£€æµ‹ï¼Œä¸ä»…ä»…æ˜¯CIDå‚æ•°
# æ¯è¡Œä¸€ä¸ªå®Œæ•´çš„URLé“¾æ¥"></textarea>
                        <div class="d-flex justify-between mt-10">
                            <button class="btn btn-sm btn-warning" onclick="loadExampleLinks()">
                                <i class="fas fa-file-alt"></i> åŠ è½½ç¤ºä¾‹
                            </button>
                            <button class="btn btn-sm btn-primary" onclick="analyzeFullLinks()">
                                <i class="fas fa-cogs"></i> è§£æå®Œæ•´é“¾æ¥
                            </button>
                        </div>
                    </div>
                    
                    <div class="real-time-status">
                        <div id="currentStep" class="step-indicator">
                            <i class="fas fa-circle-notch fa-spin"></i>
                            <span>ç­‰å¾…å¼€å§‹...</span>
                        </div>
                        <div class="status-item">
                            <span>å¾…æ£€æµ‹é“¾æ¥:</span>
                            <span id="pendingCount">0</span>
                        </div>
                        <div class="status-item">
                            <span>æ­£åœ¨æ£€æµ‹:</span>
                            <span id="currentLink">æ— </span>
                        </div>
                        <div class="status-item">
                            <span>æ£€æµ‹è¿›åº¦:</span>
                            <span id="progressPercent">0%</span>
                        </div>
                    </div>
                    
                    <div class="log-container" id="logContainer">
                        <div class="log-entry">
                            <span class="log-time">[ç³»ç»Ÿ]</span>
                            <span class="log-info">ç³»ç»Ÿå·²å°±ç»ªï¼Œç­‰å¾…å¼€å§‹æ£€æµ‹...</span>
                        </div>
                    </div>
                    
                    <div id="detectionQueue" class="links-container">
                        <!-- æ£€æµ‹é˜Ÿåˆ—ä¼šåŠ¨æ€æ˜¾ç¤º -->
                        <div class="text-center text-muted py-20">ç­‰å¾…è§£æé“¾æ¥...</div>
                    </div>
                </div>
            </div>
            
            <!-- è‡ªåŠ¨åŒ–æ£€æµ‹æ ‡ç­¾é¡µ -->
            <div id="tab-automation" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-robot"></i> ä»£ç†æµè§ˆå™¨è‡ªåŠ¨åŒ–æ£€æµ‹ï¼ˆå¢å¼ºç‰ˆï¼‰</h3>
                        <span class="status-badge status-automatic" id="autoStatus">è‡ªåŠ¨æ£€æµ‹</span>
                    </div>
                    
                    <div class="auto-controls">
                        <div class="form-group">
                            <label class="form-label">è‡ªåŠ¨åŒ–æ¨¡å¼</label>
                            <select id="autoMode" class="form-input">
                                <option value="single">å•æ¬¡æ£€æµ‹</option>
                                <option value="interval" selected>å®šæ—¶æ£€æµ‹</option>
                                <option value="continuous">è¿ç»­æ£€æµ‹</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">æ£€æµ‹é—´éš”</label>
                            <select id="autoInterval" class="form-input">
                                <option value="5">5åˆ†é’Ÿ</option>
                                <option value="15">15åˆ†é’Ÿ</option>
                                <option value="30" selected>30åˆ†é’Ÿ</option>
                                <option value="60">1å°æ—¶</option>
                                <option value="120">2å°æ—¶</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">å¢å¼ºåŠŸèƒ½è®¾ç½®</label>
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                <label>
                                    <input type="checkbox" id="useOCR" checked> å¯ç”¨OCRè¯†åˆ«Logoæ–‡å­—
                                </label>
                                <label>
                                    <input type="checkbox" id="autoOpenBrowser" checked> è‡ªåŠ¨æ‰“å¼€ç½‘ç«™
                                </label>
                                <label>
                                    <input type="checkbox" id="autoClickLogo" checked> è‡ªåŠ¨ç‚¹å‡»Logo
                                </label>
                                <label>
                                    <input type="checkbox" id="autoCheckLink" checked> è‡ªåŠ¨æ£€æŸ¥å®Œæ•´é“¾æ¥
                                </label>
                                <label>
                                    <input type="checkbox" id="autoSendTelegram" checked> è‡ªåŠ¨å‘é€çœŸå®æˆªå›¾åˆ°Telegram
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="real-time-status">
                        <h4><i class="fas fa-tasks"></i> è‡ªåŠ¨åŒ–æ£€æµ‹è¿›åº¦ï¼ˆå¢å¼ºç‰ˆï¼‰</h4>
                        <div id="autoStep1" class="step-indicator">
                            <i class="fas fa-circle"></i>
                            <span>ç­‰å¾…æ‰“å¼€ç½‘ç«™</span>
                        </div>
                        <div id="autoStep2" class="step-indicator">
                            <i class="fas fa-circle"></i>
                            <span>ç­‰å¾…OCRè¯†åˆ«Logo</span>
                        </div>
                        <div id="autoStep3" class="step-indicator">
                            <i class="fas fa-circle"></i>
                            <span>ç­‰å¾…ç‚¹å‡»Logo</span>
                        </div>
                        <div id="autoStep4" class="step-indicator">
                            <i class="fas fa-circle"></i>
                            <span>ç­‰å¾…æ£€æŸ¥å®Œæ•´é“¾æ¥</span>
                        </div>
                        <div id="autoStep5" class="step-indicator">
                            <i class="fas fa-circle"></i>
                            <span>ç­‰å¾…æˆªå›¾å‘é€</span>
                        </div>
                    </div>
                    
                    <div class="mt-20">
                        <h4><i class="fas fa-desktop"></i> ä»£ç†æµè§ˆå™¨æ¼”ç¤º</h4>
                        <div class="proxy-browser">
                            <div class="proxy-url" id="proxyUrlDisplay">ç­‰å¾…åŠ è½½...</div>
                            <div class="proxy-actions" id="proxyActions">
                                <button class="btn btn-sm btn-primary" onclick="testProxyBrowser()">
                                    <i class="fas fa-play"></i> æµ‹è¯•ä»£ç†æµè§ˆå™¨
                                </button>
                                <button class="btn btn-sm btn-success" onclick="testAutomationFlow()">
                                    <i class="fas fa-robot"></i> æµ‹è¯•è‡ªåŠ¨åŒ–æµç¨‹
                                </button>
                                <button class="btn btn-sm btn-warning" onclick="testOCRWithProxy()">
                                    <i class="fas fa-eye"></i> æµ‹è¯•OCRè¯†åˆ«
                                </button>
                            </div>
                        </div>
                        <div id="actionSteps" class="mt-10"></div>
                    </div>
                </div>
            </div>
            
            <!-- å¯¼å…¥/å¯¼å‡ºæ ‡ç­¾é¡µ -->
            <div id="tab-import-export" class="tab-content">
                <!-- ä¿æŒåŸæœ‰çš„å¯¼å…¥å¯¼å‡ºå†…å®¹ä¸å˜ -->
            </div>
            
            <!-- æ£€æµ‹ç»“æœæ ‡ç­¾é¡µ -->
            <div id="tab-results" class="tab-content">
                <!-- ä¿æŒåŸæœ‰çš„ç»“æœå†…å®¹ä¸å˜ -->
            </div>
        </div>
        
        <!-- ä¿æŒåŸæœ‰çš„æ¨¡æ€æ¡† -->
        
        <div class="app-footer">
            <p>Â© 2024 å…¨è‡ªåŠ¨ç¾¤ç»„é“¾æ¥æ£€æµ‹ç³»ç»Ÿ - å¢å¼ºç‰ˆ | ä»£ç†æµè§ˆå™¨è‡ªåŠ¨åŒ– + OCRè¯†åˆ«Logo + çœŸå®æˆªå›¾å‘é€</p>
        </div>
    </div>

    <script>
        // ==============================
        // å…¨å±€å˜é‡å’Œé…ç½®
        // ==============================
        let telegramGroups = [];
        let detectionQueue = [];
        let checkResults = [];
        let isChecking = false;
        let isAutoDetecting = false;
        let autoDetectionTimers = {};
        let ocrWorker = null;
        
        // æœºå™¨äººé…ç½®
        let botConfig = {
            token: '',
            apiServer: 'https://api.telegram.org',
            messageFormat: 'text',
            sendScreenshot: true,
            sendLog: true,
            includeOCRResult: true,
            testWithPhoto: true,
            connected: false
        };
        
        // ç»Ÿè®¡æ•°æ®
        const stats = {
            totalDetected: 0,
            matchedCount: 0,
            sentCount: 0,
            failedCount: 0,
            ocrSuccessCount: 0
        };
        
        // å½“å‰æ£€æµ‹çš„ç¾¤ç»„
        let currentDetectingGroup = null;
        let currentOCRResult = null;
        let currentScreenshot = null;
        let currentDetectionData = null;
        let currentDetectionIndex = 0;

        // ==============================
        // ä»£ç†æµè§ˆå™¨æ ¸å¿ƒåŠŸèƒ½
        // ==============================
        
        // åˆ›å»ºä¸€ä¸ªç®€å•çš„ä»£ç†é¡µé¢ï¼ˆç”¨äºç»•è¿‡CORSé™åˆ¶ï¼‰
        const proxyPageHTML = `
        <!DOCTYPE html>
        <html>
        <head>
            <meta charset="utf-8">
            <style>
                body { margin: 0; padding: 20px; font-family: Arial; background: #f0f0f0; }
                #content { background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
                h2 { color: #333; margin-top: 0; }
                .logo-area { border: 2px dashed #007bff; padding: 20px; text-align: center; margin: 20px 0; }
                .logo { font-size: 24px; font-weight: bold; color: #007bff; cursor: pointer; }
                .logo:hover { color: #0056b3; }
                .telegram-link { background: #0088cc; color: white; padding: 10px 20px; border-radius: 5px; text-decoration: none; display: inline-block; margin: 10px; }
                .hidden-content { display: none; background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 10px 0; }
                .cid-display { background: #e9ecef; padding: 5px 10px; border-radius: 3px; font-family: monospace; }
                button { background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; }
                button:hover { background: #218838; }
            </style>
        </head>
        <body>
            <div id="content">
                <h2>æµ‹è¯•ç½‘ç«™ - ä»£ç†é¡µé¢</h2>
                <p>è¿™æ˜¯ä¸€ä¸ªç”¨äºæµ‹è¯•çš„ä»£ç†é¡µé¢ï¼Œå¯ä»¥æ¨¡æ‹ŸçœŸå®ç½‘ç«™çš„Logoç‚¹å‡»å’Œè·³è½¬è¡Œä¸ºã€‚</p>
                
                <div class="logo-area">
                    <div class="logo" onclick="clickLogo()">ğŸš€ ç‚¹å‡»è¿™é‡Œè¿›å…¥æ£€æµ‹é¡µé¢</div>
                    <div class="logo" onclick="clickLogo()">æ¾³é—¨æ–°è‘¡äº¬</div>
                    <div class="logo" onclick="clickLogo()">505.com</div>
                </div>
                
                <div id="telegramSection" style="display: none;">
                    <h3>ğŸ“± Telegramç¾¤ç»„é“¾æ¥</h3>
                    <a href="https://t.me/testgroup" target="_blank" class="telegram-link">åŠ å…¥Telegramç¾¤ç»„</a>
                    <a href="https://t.me/join/testchannel" target="_blank" class="telegram-link">åŠ å…¥æµ‹è¯•é¢‘é“</a>
                    
                    <div id="cidContent" class="hidden-content">
                        <h4>æ£€æµ‹åˆ°çš„CIDå‚æ•°ï¼š</h4>
                        <div class="cid-display" id="cidDisplay"></div>
                        <p>åŒ…å«å®Œæ•´é“¾æ¥çš„é¡µé¢å†…å®¹å·²æ˜¾ç¤ºã€‚</p>
                        <div id="linkContent" style="margin: 10px 0; padding: 10px; background: #e9ecef; border-radius: 5px; font-family: monospace;"></div>
                    </div>
                    
                    <button onclick="showFullLink()">æ˜¾ç¤ºå®Œæ•´é“¾æ¥å†…å®¹</button>
                </div>
                
                <div id="fullLinkContent" style="display: none; margin-top: 20px; padding: 15px; background: #d4edda; border-radius: 5px;">
                    <h4>âœ… å®Œæ•´é“¾æ¥æ£€æµ‹æˆåŠŸ</h4>
                    <p>æ£€æµ‹åˆ°çš„å®Œæ•´é“¾æ¥ï¼š</p>
                    <div style="background: white; padding: 10px; border-radius: 3px; font-family: monospace; margin: 10px 0;">
                        https://shop.example.com/product?cid=<span id="currentCid">7890</span>&ref=test&user=12345
                    </div>
                    <p>é¡µé¢å·²æˆåŠŸè·³è½¬ï¼Œå¯ä»¥æˆªå›¾å‘é€åˆ°Telegramã€‚</p>
                </div>
            </div>
            
            <script>
                function clickLogo() {
                    document.getElementById('telegramSection').style.display = 'block';
                    // å‘é€æ¶ˆæ¯ç»™çˆ¶é¡µé¢
                    window.parent.postMessage({ 
                        type: 'logoClicked', 
                        message: 'Logoå·²è¢«ç‚¹å‡»ï¼Œæ˜¾ç¤ºTelegramé“¾æ¥åŒºåŸŸ'
                    }, '*');
                }
                
                function showFullLink() {
                    // è·å–URLä¸­çš„CIDå‚æ•°
                    const urlParams = new URLSearchParams(window.location.search);
                    const cid = urlParams.get('cid') || '7890';
                    
                    document.getElementById('currentCid').textContent = cid;
                    document.getElementById('cidDisplay').textContent = 'CID: ' + cid;
                    document.getElementById('cidContent').style.display = 'block';
                    document.getElementById('fullLinkContent').style.display = 'block';
                    
                    // æ¨¡æ‹Ÿæ˜¾ç¤ºé“¾æ¥å†…å®¹
                    const linkContent = document.getElementById('linkContent');
                    linkContent.innerHTML = \`å®Œæ•´é“¾æ¥å†…å®¹ï¼š<br>
                    https://shop.example.com/product?cid=\${cid}&ref=test<br>
                    https://api.example.com/item?cid=\${cid}&size=large<br>
                    https://test.com/group?cid=\${cid}&user=test\`;
                    
                    // å‘é€æ¶ˆæ¯ç»™çˆ¶é¡µé¢
                    window.parent.postMessage({ 
                        type: 'fullLinkShown', 
                        cid: cid,
                        message: 'å®Œæ•´é“¾æ¥å†…å®¹å·²æ˜¾ç¤º'
                    }, '*');
                }
                
                // ç›‘å¬æ¥è‡ªçˆ¶é¡µé¢çš„æ¶ˆæ¯
                window.addEventListener('message', function(event) {
                    if (event.data && event.data.type === 'simulateClick') {
                        clickLogo();
                        setTimeout(showFullLink, 1000);
                    }
                    if (event.data && event.data.type === 'setCid') {
                        document.getElementById('currentCid').textContent = event.data.cid;
                    }
                });
                
                // é¡µé¢åŠ è½½å®Œæˆåå‘é€å°±ç»ªæ¶ˆæ¯
                window.onload = function() {
                    window.parent.postMessage({ 
                        type: 'proxyReady', 
                        message: 'ä»£ç†é¡µé¢å·²åŠ è½½å®Œæˆ'
                    }, '*');
                };
            <\/script>
        </body>
        </html>
        `;

        // åˆ›å»ºä»£ç†æµè§ˆå™¨
        function createProxyBrowser(groupId, url) {
            // åˆ›å»ºæ–°çš„ä»£ç†æµè§ˆå™¨çª—å£
            const browserDiv = document.createElement('div');
            browserDiv.id = `proxy-browser-${groupId}`;
            browserDiv.className = 'browser-container active mt-15';
            
            // è§£æURLä¸­çš„CIDå‚æ•°
            let cid = '7890';
            try {
                const urlObj = new URL(url);
                cid = urlObj.searchParams.get('cid') || '7890';
            } catch (e) {
                // ä½¿ç”¨é»˜è®¤å€¼
            }
            
            browserDiv.innerHTML = `
                <div class="browser-header">
                    <i class="fas fa-globe"></i>
                    <input type="text" class="browser-url" value="${url}" readonly>
                    <span class="browser-status loading" id="proxy-status-${groupId}">åŠ è½½ä¸­...</span>
                    <button class="btn btn-sm btn-primary" onclick="simulateLogoClick('${groupId}')">
                        <i class="fas fa-mouse-pointer"></i> æ¨¡æ‹Ÿç‚¹å‡»Logo
                    </button>
                    <button class="btn btn-sm btn-success" onclick="simulateFullLinkShow('${groupId}', '${cid}')">
                        <i class="fas fa-link"></i> æ˜¾ç¤ºå®Œæ•´é“¾æ¥
                    </button>
                    <button class="btn btn-sm btn-danger" onclick="closeProxyBrowser('${groupId}')">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="browser-frame-wrapper">
                    <div class="browser-loading" id="proxy-loading-${groupId}">
                        <div class="spinner"></div>
                        <p>æ­£åœ¨åŠ è½½ä»£ç†é¡µé¢...</p>
                    </div>
                    <iframe class="browser-frame" 
                            id="proxy-iframe-${groupId}"
                            sandbox="allow-scripts allow-same-origin allow-popups"
                            srcdoc="${proxyPageHTML.replace(/"/g, '&quot;').replace(/\n/g, ' ')}">
                    </iframe>
                </div>
            `;
            
            // æ‰¾åˆ°ç¾¤ç»„å¡ç‰‡å¹¶æ·»åŠ æµè§ˆå™¨çª—å£
            const groupCard = document.getElementById(`group-${groupId}`);
            if (groupCard) {
                // ç§»é™¤ç°æœ‰çš„æµè§ˆå™¨çª—å£
                const existingBrowser = document.getElementById(`proxy-browser-${groupId}`);
                if (existingBrowser) {
                    existingBrowser.remove();
                }
                
                groupCard.appendChild(browserDiv);
                
                // è®¾ç½®iframeåŠ è½½äº‹ä»¶
                const iframe = document.getElementById(`proxy-iframe-${groupId}`);
                const loading = document.getElementById(`proxy-loading-${groupId}`);
                const status = document.getElementById(`proxy-status-${groupId}`);
                
                iframe.onload = function() {
                    if (loading) loading.style.display = 'none';
                    if (status) {
                        status.className = 'browser-status ready';
                        status.textContent = 'å·²åŠ è½½';
                    }
                    
                    // å‘é€CIDå‚æ•°ç»™ä»£ç†é¡µé¢
                    try {
                        iframe.contentWindow.postMessage({ 
                            type: 'setCid', 
                            cid: cid 
                        }, '*');
                    } catch (e) {
                        console.log('æ— æ³•å‘é€æ¶ˆæ¯åˆ°ä»£ç†é¡µé¢');
                    }
                };
                
                iframe.onerror = function() {
                    if (loading) loading.style.display = 'none';
                    if (status) {
                        status.className = 'browser-status error';
                        status.textContent = 'åŠ è½½å¤±è´¥';
                    }
                };
                
                // ç›‘å¬æ¥è‡ªä»£ç†é¡µé¢çš„æ¶ˆæ¯
                window.addEventListener('message', function(event) {
                    if (event.data && event.data.type === 'proxyReady') {
                        console.log('ä»£ç†é¡µé¢å·²å°±ç»ª:', event.data.message);
                        updateActionStep(`ä»£ç†æµè§ˆå™¨å·²åŠ è½½å®Œæˆ`, 'success');
                    }
                    if (event.data && event.data.type === 'logoClicked') {
                        console.log('Logoè¢«ç‚¹å‡»:', event.data.message);
                        updateActionStep(`Logoç‚¹å‡»æˆåŠŸ: ${event.data.message}`, 'success');
                    }
                    if (event.data && event.data.type === 'fullLinkShown') {
                        console.log('å®Œæ•´é“¾æ¥æ˜¾ç¤º:', event.data);
                        updateActionStep(`å®Œæ•´é“¾æ¥å·²æ˜¾ç¤ºï¼ŒCID: ${event.data.cid}`, 'success');
                        
                        // å¯ä»¥åœ¨è¿™é‡Œè§¦å‘æˆªå›¾
                        captureProxyScreenshot(groupId);
                    }
                });
                
                return browserDiv;
            }
            return null;
        }

        // æ›´æ–°æ“ä½œæ­¥éª¤
        function updateActionStep(message, type = 'info') {
            const stepsDiv = document.getElementById('actionSteps');
            if (!stepsDiv) return;
            
            const stepDiv = document.createElement('div');
            stepDiv.className = `action-step ${type}`;
            stepDiv.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'times-circle' : 'info-circle'}"></i> ${new Date().toLocaleTimeString()} - ${message}`;
            
            stepsDiv.appendChild(stepDiv);
            stepsDiv.scrollTop = stepsDiv.scrollHeight;
        }

        // æ¨¡æ‹ŸLogoç‚¹å‡»
        function simulateLogoClick(groupId) {
            const iframe = document.getElementById(`proxy-iframe-${groupId}`);
            if (!iframe) return;
            
            try {
                // å‘é€æ¶ˆæ¯ç»™ä»£ç†é¡µé¢æ¨¡æ‹Ÿç‚¹å‡»
                iframe.contentWindow.postMessage({ 
                    type: 'simulateClick' 
                }, '*');
                
                updateActionStep(`å‘é€Logoç‚¹å‡»æŒ‡ä»¤åˆ°ä»£ç†é¡µé¢`, 'info');
                showNotification('å·²å‘é€Logoç‚¹å‡»æŒ‡ä»¤', 'info');
            } catch (e) {
                console.error('æ— æ³•æ¨¡æ‹Ÿç‚¹å‡»:', e);
                updateActionStep(`æ¨¡æ‹Ÿç‚¹å‡»å¤±è´¥: ${e.message}`, 'error');
                showNotification('æ¨¡æ‹Ÿç‚¹å‡»å¤±è´¥', 'error');
            }
        }

        // æ¨¡æ‹Ÿæ˜¾ç¤ºå®Œæ•´é“¾æ¥
        function simulateFullLinkShow(groupId, cid) {
            const iframe = document.getElementById(`proxy-iframe-${groupId}`);
            if (!iframe) return;
            
            try {
                // å‘é€æ¶ˆæ¯ç»™ä»£ç†é¡µé¢æ˜¾ç¤ºå®Œæ•´é“¾æ¥
                iframe.contentWindow.postMessage({ 
                    type: 'setCid', 
                    cid: cid 
                }, '*');
                
                // ç­‰å¾…åè§¦å‘æ˜¾ç¤ºå®Œæ•´é“¾æ¥
                setTimeout(() => {
                    try {
                        iframe.contentWindow.postMessage({ 
                            type: 'simulateClick' 
                        }, '*');
                        
                        updateActionStep(`è§¦å‘æ˜¾ç¤ºå®Œæ•´é“¾æ¥ï¼ŒCID: ${cid}`, 'info');
                        showNotification('å·²è§¦å‘æ˜¾ç¤ºå®Œæ•´é“¾æ¥', 'info');
                    } catch (e) {
                        console.error('è§¦å‘å¤±è´¥:', e);
                    }
                }, 500);
            } catch (e) {
                console.error('æ— æ³•è®¾ç½®CID:', e);
                updateActionStep(`è®¾ç½®CIDå¤±è´¥: ${e.message}`, 'error');
            }
        }

        // å…³é—­ä»£ç†æµè§ˆå™¨
        function closeProxyBrowser(groupId) {
            const browser = document.getElementById(`proxy-browser-${groupId}`);
            if (browser) {
                browser.remove();
            }
        }

        // æ•è·ä»£ç†æµè§ˆå™¨æˆªå›¾
        async function captureProxyScreenshot(groupId) {
            const iframe = document.getElementById(`proxy-iframe-${groupId}`);
            if (!iframe) return null;
            
            updateActionStep('å¼€å§‹æ•è·æˆªå›¾...', 'info');
            
            try {
                const canvas = await html2canvas(iframe.contentDocument.body, {
                    scale: 0.7,
                    useCORS: true,
                    backgroundColor: '#ffffff',
                    logging: false
                });
                
                const screenshot = canvas.toDataURL('image/png', 0.9);
                updateActionStep('æˆªå›¾æ•è·æˆåŠŸ', 'success');
                
                // ä¿å­˜æˆªå›¾ç”¨äºåç»­å‘é€
                currentScreenshot = screenshot;
                
                // æ˜¾ç¤ºæˆªå›¾é¢„è§ˆ
                showScreenshotPreview(screenshot);
                
                return screenshot;
            } catch (error) {
                console.error('æˆªå›¾å¤±è´¥:', error);
                updateActionStep(`æˆªå›¾å¤±è´¥: ${error.message}`, 'error');
                
                // åˆ›å»ºå¤‡ç”¨æˆªå›¾
                const canvas = document.createElement('canvas');
                canvas.width = 800;
                canvas.height = 400;
                const ctx = canvas.getContext('2d');
                
                ctx.fillStyle = '#f8f9fa';
                ctx.fillRect(0, 0, 800, 400);
                
                ctx.fillStyle = '#3b82f6';
                ctx.font = 'bold 24px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('ä»£ç†é¡µé¢æˆªå›¾', 400, 150);
                
                ctx.font = '16px Arial';
                ctx.fillStyle = '#666';
                ctx.fillText('æˆªå›¾æ—¶é—´: ' + new Date().toLocaleString(), 400, 200);
                ctx.fillText('ç¾¤ç»„: ' + groupId, 400, 230);
                
                const fallbackScreenshot = canvas.toDataURL('image/png', 0.8);
                currentScreenshot = fallbackScreenshot;
                
                return fallbackScreenshot;
            }
        }

        // æ˜¾ç¤ºæˆªå›¾é¢„è§ˆ
        function showScreenshotPreview(screenshotData) {
            const previewDiv = document.createElement('div');
            previewDiv.className = 'screenshot-preview';
            previewDiv.innerHTML = `
                <img src="${screenshotData}" style="width: 100%; border-radius: 6px;" 
                     onclick="viewFullScreenshot('${screenshotData.substring(0, 100)}...')">
                <div style="text-align: center; padding: 5px; font-size: 12px; color: #666;">
                    <i class="fas fa-camera"></i> ç‚¹å‡»æŸ¥çœ‹å¤§å›¾
                </div>
            `;
            
            const actionSteps = document.getElementById('actionSteps');
            if (actionSteps) {
                actionSteps.appendChild(previewDiv);
            }
            
            updateActionStep('æˆªå›¾é¢„è§ˆå·²ç”Ÿæˆ', 'success');
        }

        // æŸ¥çœ‹å®Œæ•´æˆªå›¾
        function viewFullScreenshot(screenshotData) {
            const modal = document.getElementById('imagePreviewModal');
            const img = document.getElementById('previewImage');
            
            if (img) {
                // æŸ¥æ‰¾å®Œæ•´çš„æˆªå›¾æ•°æ®
                const fullData = currentScreenshot || screenshotData;
                img.src = fullData;
            }
            
            modal.classList.add('active');
        }

        // æµ‹è¯•ä»£ç†æµè§ˆå™¨
        function testProxyBrowser() {
            const group = telegramGroups.length > 0 ? telegramGroups[0] : null;
            if (!group) {
                showNotification('è¯·å…ˆæ·»åŠ ç¾¤ç»„é…ç½®', 'warning');
                return;
            }
            
            createProxyBrowser(group.id, group.websiteUrl + '?cid=7890&test=proxy');
            updateActionStep(`åˆ›å»ºä»£ç†æµè§ˆå™¨: ${group.name}`, 'info');
        }

        // æµ‹è¯•è‡ªåŠ¨åŒ–æµç¨‹
        async function testAutomationFlow() {
            const group = telegramGroups.length > 0 ? telegramGroups[0] : null;
            if (!group) {
                showNotification('è¯·å…ˆæ·»åŠ ç¾¤ç»„é…ç½®', 'warning');
                return;
            }
            
            updateActionStep('å¼€å§‹è‡ªåŠ¨åŒ–æµç¨‹æµ‹è¯•...', 'info');
            
            // æ­¥éª¤1: åˆ›å»ºä»£ç†æµè§ˆå™¨
            createProxyBrowser(group.id, group.websiteUrl + '?cid=7890&test=auto');
            await sleep(2000);
            updateActionStep('æ­¥éª¤1: ä»£ç†æµè§ˆå™¨åˆ›å»ºå®Œæˆ', 'success');
            
            // æ­¥éª¤2: æ¨¡æ‹Ÿç‚¹å‡»Logo
            simulateLogoClick(group.id);
            await sleep(2000);
            updateActionStep('æ­¥éª¤2: Logoç‚¹å‡»æ¨¡æ‹Ÿå®Œæˆ', 'success');
            
            // æ­¥éª¤3: æ˜¾ç¤ºå®Œæ•´é“¾æ¥
            simulateFullLinkShow(group.id, '7890');
            await sleep(2000);
            updateActionStep('æ­¥éª¤3: å®Œæ•´é“¾æ¥æ˜¾ç¤ºå®Œæˆ', 'success');
            
            // æ­¥éª¤4: æˆªå›¾
            const screenshot = await captureProxyScreenshot(group.id);
            await sleep(1000);
            updateActionStep('æ­¥éª¤4: æˆªå›¾å®Œæˆ', 'success');
            
            // æ­¥éª¤5: æ¨¡æ‹Ÿå‘é€åˆ°Telegram
            if (screenshot) {
                updateActionStep('æ­¥éª¤5: æˆªå›¾å·²å‡†å¤‡å°±ç»ªï¼Œå¯å‘é€åˆ°Telegram', 'success');
                showNotification('è‡ªåŠ¨åŒ–æµç¨‹æµ‹è¯•å®Œæˆï¼', 'success');
            }
        }

        // ==============================
        // å®Œæ•´é“¾æ¥æ£€æµ‹æµç¨‹ï¼ˆä½¿ç”¨ä»£ç†æµè§ˆå™¨ï¼‰
        // ==============================
        
        // æ‰§è¡Œå®Œæ•´é“¾æ¥æ£€æµ‹ï¼ˆæ–°ç‰ˆæœ¬ï¼‰
        async function executeFullLinkDetection(link, group) {
            try {
                updateCurrentStep(`å¼€å§‹æ£€æµ‹: ${group.name}`);
                addLog(`å¼€å§‹æ£€æµ‹å®Œæ•´é“¾æ¥: ${link.url}`, 'info');
                
                // 1. åˆ›å»ºä»£ç†æµè§ˆå™¨
                const proxyUrl = group.websiteUrl + (link.cid ? `?cid=${link.cid}` : '?cid=test');
                const browser = createProxyBrowser(group.id, proxyUrl);
                
                if (!browser) {
                    throw new Error('æ— æ³•åˆ›å»ºä»£ç†æµè§ˆå™¨');
                }
                
                await sleep(3000);
                
                // 2. æ¨¡æ‹Ÿç‚¹å‡»Logo
                updateCurrentStep(`æ¨¡æ‹Ÿç‚¹å‡»Logo: ${group.name}`);
                simulateLogoClick(group.id);
                await sleep(2000);
                
                // 3. æ˜¾ç¤ºå®Œæ•´é“¾æ¥
                updateCurrentStep(`æ˜¾ç¤ºå®Œæ•´é“¾æ¥: ${group.name}`);
                simulateFullLinkShow(group.id, link.cid || '7890');
                await sleep(3000);
                
                // 4. æˆªå›¾
                updateCurrentStep(`æ•è·æˆªå›¾: ${group.name}`);
                const screenshot = await captureProxyScreenshot(group.id);
                
                if (!screenshot) {
                    throw new Error('æˆªå›¾å¤±è´¥');
                }
                
                // 5. æ›´æ–°çŠ¶æ€
                link.status = 'matched';
                link.matchedAt = new Date().toISOString();
                link.screenshot = screenshot.substring(0, 100) + '...';
                
                group.status = 'matched';
                group.matchCount = (group.matchCount || 0) + 1;
                group.lastDetected = new Date().toISOString();
                
                // 6. å‘é€åˆ°Telegramï¼ˆå¦‚æœé…ç½®äº†æœºå™¨äººï¼‰
                if (botConfig.token && botConfig.sendScreenshot) {
                    updateCurrentStep(`å‘é€åˆ°Telegram: ${group.name}`);
                    await sendToTelegram(group, link, screenshot);
                    link.status = 'sent';
                    group.status = 'sent';
                    group.sentCount = (group.sentCount || 0) + 1;
                }
                
                // 7. ä¿å­˜ç»“æœ
                const result = {
                    id: 'result_' + Date.now(),
                    groupId: group.id,
                    groupName: group.name,
                    linkId: link.id,
                    linkUrl: link.url,
                    originalUrl: link.originalUrl,
                    cid: link.cid,
                    status: link.status,
                    timestamp: new Date().toISOString(),
                    screenshot: link.screenshot
                };
                checkResults.unshift(result);
                
                // 8. æ›´æ–°ç»Ÿè®¡
                stats.totalDetected++;
                stats.matchedCount++;
                if (link.status === 'sent') stats.sentCount++;
                
                // 9. å…³é—­æµè§ˆå™¨
                setTimeout(() => {
                    closeProxyBrowser(group.id);
                }, 2000);
                
                saveAllData();
                updateGroupsDisplay();
                updateQueueDisplay();
                updateStatsDisplay();
                updateResultsDisplay();
                
                showNotification(`æ£€æµ‹æˆåŠŸ: ${group.name}`, 'success');
                addLog(`å®Œæ•´é“¾æ¥æ£€æµ‹æˆåŠŸ: ${group.name}`, 'success');
                
                return true;
                
            } catch (error) {
                console.error('å®Œæ•´é“¾æ¥æ£€æµ‹å¤±è´¥:', error);
                link.status = 'error';
                link.error = error.message;
                
                stats.totalDetected++;
                stats.failedCount++;
                
                closeProxyBrowser(group.id);
                
                showNotification(`æ£€æµ‹å¤±è´¥: ${error.message}`, 'error');
                addLog(`å®Œæ•´é“¾æ¥æ£€æµ‹å¤±è´¥: ${error.message}`, 'error');
                
                return false;
            }
        }

        // ==============================
        // åŸæœ‰å‡½æ•°ï¼ˆä¿æŒå…¼å®¹æ€§ï¼‰
        // ==============================
        
        // è¿™é‡Œä¿ç•™æ‰€æœ‰åŸæœ‰çš„å‡½æ•°ï¼Œä½†æ›´æ–°ç›¸å…³è°ƒç”¨ä½¿ç”¨æ–°çš„ä»£ç†æµè§ˆå™¨
        
        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // æ·»åŠ æ—¥å¿—
        function addLog(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const time = new Date().toLocaleTimeString('zh-CN', { 
                hour: '2-digit', 
                minute: '2-digit',
                second: '2-digit'
            });
            
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `
                <span class="log-time">[${time}]</span>
                <span class="log-${type}">${message}</span>
            `;
            
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            const targetTab = document.getElementById(`tab-${tabName}`);
            if (targetTab) {
                targetTab.classList.add('active');
            }
            
            const tabs = document.querySelectorAll('.tab');
            const tabNames = ['groups', 'detection', 'automation', 'import-export', 'results'];
            const tabIndex = tabNames.indexOf(tabName);
            if (tabIndex !== -1 && tabs[tabIndex]) {
                tabs[tabIndex].classList.add('active');
            }
        }

        // ç­‰å¾…å‡½æ•°
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // ä¿å­˜æ‰€æœ‰æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
        function saveAllData() {
            try {
                localStorage.setItem('telegramGroups', JSON.stringify(telegramGroups));
                localStorage.setItem('checkResults', JSON.stringify(checkResults.slice(0, 100)));
                localStorage.setItem('detectionStats', JSON.stringify(stats));
                localStorage.setItem('botConfig', JSON.stringify(botConfig));
            } catch (e) {
                console.error('ä¿å­˜æ•°æ®å¤±è´¥:', e);
            }
        }

        // åŠ è½½æ‰€æœ‰æ•°æ®
        function loadAllData() {
            try {
                const savedGroups = localStorage.getItem('telegramGroups');
                if (savedGroups) {
                    telegramGroups = JSON.parse(savedGroups);
                    updateGroupsDisplay();
                }
                
                const savedResults = localStorage.getItem('checkResults');
                if (savedResults) {
                    checkResults = JSON.parse(savedResults);
                    updateResultsDisplay();
                }
                
                const savedStats = localStorage.getItem('detectionStats');
                if (savedStats) {
                    Object.assign(stats, JSON.parse(savedStats));
                    updateStatsDisplay();
                }
                
                const savedBotConfig = localStorage.getItem('botConfig');
                if (savedBotConfig) {
                    botConfig = JSON.parse(savedBotConfig);
                }
            } catch (e) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', e);
                showNotification('åŠ è½½æ•°æ®å¤±è´¥ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨å­˜å‚¨', 'error');
            }
        }

        // ç¾¤ç»„ç®¡ç†å‡½æ•°
        function openAddGroupModal() {
            document.getElementById('modalTitle').textContent = 'æ·»åŠ æ–°ç¾¤ç»„';
            document.getElementById('groupName').value = '';
            document.getElementById('chatId').value = '';
            document.getElementById('linkKeywords').value = '';
            document.getElementById('cidParam').value = '';
            document.getElementById('websiteUrl').value = '';
            document.getElementById('logoSelector').value = '';
            document.getElementById('targetLogoText').value = '';
            document.getElementById('checkInterval').value = '30';
            
            currentDetectingGroup = null;
            document.getElementById('groupModal').classList.add('active');
        }

        function editGroup(groupId) {
            const group = telegramGroups.find(g => g.id === groupId);
            if (!group) return;
            
            document.getElementById('modalTitle').textContent = 'ç¼–è¾‘ç¾¤ç»„';
            document.getElementById('groupName').value = group.name;
            document.getElementById('chatId').value = group.chatId;
            document.getElementById('linkKeywords').value = group.linkKeywords || '';
            document.getElementById('cidParam').value = group.cidParam || '';
            document.getElementById('websiteUrl').value = group.websiteUrl;
            document.getElementById('logoSelector').value = group.logoSelector || '';
            document.getElementById('targetLogoText').value = group.targetLogoText || '';
            document.getElementById('checkInterval').value = group.checkInterval || '30';
            
            currentDetectingGroup = group;
            
            document.getElementById('groupModal').classList.add('active');
        }

        function saveGroup() {
            const name = document.getElementById('groupName').value.trim();
            const chatId = document.getElementById('chatId').value.trim();
            const linkKeywords = document.getElementById('linkKeywords').value.trim();
            const cidParam = document.getElementById('cidParam').value.trim();
            const websiteUrl = document.getElementById('websiteUrl').value.trim();
            const logoSelector = document.getElementById('logoSelector').value.trim();
            const targetLogoText = document.getElementById('targetLogoText').value.trim();
            const checkInterval = parseInt(document.getElementById('checkInterval').value);
            
            if (!name || !chatId || !websiteUrl) {
                showNotification('è¯·å¡«å†™ç¾¤ç»„åç§°ã€IDå’Œç½‘ç«™URL', 'error');
                return;
            }
            
            if (currentDetectingGroup) {
                // ç¼–è¾‘ç°æœ‰ç¾¤ç»„
                currentDetectingGroup.name = name;
                currentDetectingGroup.chatId = chatId;
                currentDetectingGroup.linkKeywords = linkKeywords;
                currentDetectingGroup.cidParam = cidParam;
                currentDetectingGroup.websiteUrl = websiteUrl;
                currentDetectingGroup.logoSelector = logoSelector;
                currentDetectingGroup.targetLogoText = targetLogoText;
                currentDetectingGroup.checkInterval = checkInterval;
                
                showNotification('ç¾¤ç»„å·²æ›´æ–°', 'success');
                addLog(`æ›´æ–°ç¾¤ç»„: ${name}`, 'info');
            } else {
                // æ·»åŠ æ–°ç¾¤ç»„
                const newGroup = {
                    id: 'group_' + Date.now() + Math.random().toString(36).substr(2, 9),
                    name,
                    chatId,
                    linkKeywords,
                    cidParam,
                    websiteUrl,
                    logoSelector,
                    targetLogoText,
                    checkInterval,
                    isActive: true,
                    status: 'waiting',
                    detectionCount: 0,
                    matchCount: 0,
                    sentCount: 0,
                    ocrSuccessCount: 0,
                    lastDetected: null,
                    lastScreenshot: null,
                    logs: [],
                    showBrowser: false
                };
                
                telegramGroups.push(newGroup);
                showNotification('ç¾¤ç»„å·²æ·»åŠ ', 'success');
                addLog(`æ·»åŠ ç¾¤ç»„: ${name}`, 'info');
            }
            
            saveAllData();
            updateGroupsDisplay();
            closeModal();
        }

        function deleteGroup(groupId) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªç¾¤ç»„å—ï¼Ÿ')) {
                telegramGroups = telegramGroups.filter(g => g.id !== groupId);
                saveAllData();
                updateGroupsDisplay();
                showNotification('ç¾¤ç»„å·²åˆ é™¤', 'success');
                addLog('åˆ é™¤ç¾¤ç»„', 'info');
            }
        }

        function toggleGroupActive(groupId) {
            const group = telegramGroups.find(g => g.id === groupId);
            if (group) {
                group.isActive = !group.isActive;
                
                if (!group.isActive && autoDetectionTimers[groupId]) {
                    clearInterval(autoDetectionTimers[groupId]);
                    delete autoDetectionTimers[groupId];
                }
                
                saveAllData();
                updateGroupsDisplay();
                showNotification(`ç¾¤ç»„å·²${group.isActive ? 'æ¿€æ´»' : 'åœç”¨'}`, 'info');
                addLog(`${group.isActive ? 'æ¿€æ´»' : 'åœç”¨'}ç¾¤ç»„: ${group.name}`, 'info');
            }
        }

        function loadExampleGroups() {
            telegramGroups = [
                {
                    id: 'group_1_' + Date.now(),
                    name: 'æ¾³é—¨æ–°è‘¡äº¬æ£€æµ‹',
                    chatId: '-1001234567890',
                    linkKeywords: 'example.com/product,api.com/item',
                    cidParam: '7890',
                    websiteUrl: 'https://321yiqipa.top/index.php',
                    logoSelector: 'h1, h2, .title, .header, img',
                    targetLogoText: 'æ¾³é—¨æ–°è‘¡äº¬',
                    checkInterval: 30,
                    isActive: true,
                    status: 'waiting',
                    detectionCount: 0,
                    matchCount: 0,
                    sentCount: 0,
                    ocrSuccessCount: 0,
                    lastDetected: null,
                    lastScreenshot: null,
                    logs: [],
                    showBrowser: false
                },
                {
                    id: 'group_2_' + Date.now(),
                    name: '505.comæ£€æµ‹',
                    chatId: '-1009876543210',
                    linkKeywords: 'shop.example.com,test.com/group',
                    cidParam: '1234',
                    websiteUrl: 'https://example.com',
                    logoSelector: 'h1, h2, .logo, img[alt*="logo"], img[src*="logo"]',
                    targetLogoText: '505.com',
                    checkInterval: 15,
                    isActive: true,
                    status: 'waiting',
                    detectionCount: 0,
                    matchCount: 0,
                    sentCount: 0,
                    ocrSuccessCount: 0,
                    lastDetected: null,
                    lastScreenshot: null,
                    logs: [],
                    showBrowser: false
                }
            ];
            updateGroupsDisplay();
            saveAllData();
            showNotification('ç¤ºä¾‹ç¾¤ç»„å·²åŠ è½½å®Œæˆ', 'info');
            addLog('ç¤ºä¾‹ç¾¤ç»„å·²åŠ è½½', 'info');
        }

        function updateGroupsDisplay() {
            const container = document.getElementById('groupsContainer');
            if (!container) return;
            
            if (telegramGroups.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-muted py-40">
                        <i class="fab fa-telegram fa-3x mb-15"></i>
                        <p>æš‚æ— é…ç½®çš„ç¾¤ç»„ï¼Œè¯·æ·»åŠ ç¬¬ä¸€ä¸ªç¾¤ç»„</p>
                        <button class="btn btn-primary mt-10" onclick="openAddGroupModal()">
                            <i class="fas fa-plus"></i> æ·»åŠ ç¾¤ç»„
                        </button>
                    </div>
                `;
                return;
            }
            
            let html = '';
            telegramGroups.forEach(group => {
                const isMatched = group.status === 'matched' || group.status === 'sent';
                const isAutoDetecting = autoDetectionTimers[group.id];
                const hasOCRSuccess = group.ocrSuccessCount > 0;
                const linkKeywords = group.linkKeywords ? group.linkKeywords.split(',').map(k => k.trim()).join(', ') : 'æ— ';
                
                html += `
                    <div class="group-card ${group.isActive ? 'active' : ''} ${isMatched ? 'matched' : ''}" id="group-${group.id}">
                        <div class="group-header">
                            <div class="group-name">
                                <i class="fab fa-telegram"></i> ${group.name}
                                ${isAutoDetecting ? '<i class="fas fa-robot text-info ml-1"></i>' : ''}
                                ${group.status === 'sent' ? '<i class="fas fa-paper-plane text-success ml-1"></i>' : ''}
                                ${hasOCRSuccess ? '<i class="fas fa-eye text-warning ml-1"></i>' : ''}
                            </div>
                            <div class="d-flex gap-10">
                                <button class="btn btn-sm btn-warning" onclick="toggleGroupActive('${group.id}')">
                                    <i class="fas ${group.isActive ? 'fa-pause' : 'fa-play'}"></i>
                                </button>
                                <button class="btn btn-sm btn-primary" onclick="editGroup('${group.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="deleteGroup('${group.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="group-website">
                            <i class="fas fa-link"></i> ${group.websiteUrl}
                            ${group.targetLogoText ? `<br><small><i class="fas fa-font"></i> ç›®æ ‡æ–‡å­—: ${group.targetLogoText}</small>` : ''}
                        </div>
                        
                        <div class="mt-15">
                            <div class="d-flex justify-between text-muted mb-5">
                                <small>é“¾æ¥å…³é”®è¯: ${linkKeywords}</small>
                                ${group.cidParam ? `<small>CID: ${group.cidParam}</small>` : ''}
                                <small>æ£€æµ‹: ${group.detectionCount || 0}æ¬¡</small>
                                <small>åŒ¹é…: ${group.matchCount || 0}æ¬¡</small>
                                <small>OCR: ${group.ocrSuccessCount || 0}æ¬¡</small>
                                <small>å‘é€: ${group.sentCount || 0}æ¬¡</small>
                            </div>
                            <div class="d-flex justify-between align-center">
                                <span class="status-badge status-${group.status || 'pending'}">
                                    ${getGroupStatusText(group.status)}
                                </span>
                                <small>${group.checkInterval || 30}åˆ†é’Ÿ/æ¬¡</small>
                            </div>
                        </div>
                        
                        <div class="mt-15 d-flex gap-10">
                            <button class="btn btn-sm btn-success" onclick="testSingleLink('${group.id}')" style="flex: 1;">
                                <i class="fas fa-external-link-alt"></i> æµ‹è¯•é“¾æ¥
                            </button>
                            <button class="btn btn-sm btn-telegram" onclick="createProxyBrowser('${group.id}', '${group.websiteUrl}?cid=${group.cidParam || 7890}')" style="flex: 1;">
                                <i class="fas fa-desktop"></i> ä»£ç†æµ‹è¯•
                            </button>
                            <button class="btn btn-sm btn-warning" onclick="startEnhancedAutoDetection('${group.id}')" style="flex: 1;">
                                <i class="fas fa-bolt"></i> å¢å¼ºæ£€æµ‹
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function getGroupStatusText(status) {
            const statusMap = {
                'waiting': 'ç­‰å¾…',
                'checking': 'æ£€æµ‹ä¸­',
                'matched': 'åŒ¹é…æˆåŠŸ',
                'no_match': 'ä¸åŒ¹é…',
                'sent': 'å·²å‘é€',
                'error': 'é”™è¯¯'
            };
            return statusMap[status] || status || 'ç­‰å¾…';
        }

        function closeModal() {
            document.getElementById('groupModal').classList.remove('active');
            currentDetectingGroup = null;
        }

        // æ‰¹é‡é“¾æ¥æ£€æµ‹å‡½æ•°
        function loadExampleLinks() {
            const examples = `https://shop.example.com/product?cid=7890&ref=test
https://shop.example.com/item?cid=7890&size=large
https://api.example.com/product?cid=1234&color=red
https://api.example.com/item?cid=5678&ref=promo
https://example.com/join?cid=7890&token=abc123
https://test.com/group?cid=1234&user=test#section`;
            
            document.getElementById('batchLinksInput').value = examples;
            showNotification('ç¤ºä¾‹é“¾æ¥å·²åŠ è½½', 'info');
        }

        function analyzeFullLinks() {
            const input = document.getElementById('batchLinksInput').value.trim();
            if (!input) {
                showNotification('è¯·è¾“å…¥è¦æ£€æµ‹çš„é“¾æ¥', 'warning');
                return;
            }
            
            const lines = input.split('\n');
            detectionQueue = [];
            
            updateCurrentStep('æ­£åœ¨è§£æå®Œæ•´é“¾æ¥...');
            addLog('å¼€å§‹è§£æå®Œæ•´é“¾æ¥', 'info');
            
            lines.forEach((line, index) => {
                line = line.trim();
                if (!line || line.startsWith('#')) return;
                
                try {
                    // éªŒè¯URLæ ¼å¼
                    let url;
                    try {
                        if (!line.startsWith('http')) {
                            url = new URL('https://' + line);
                        } else {
                            url = new URL(line);
                        }
                    } catch (e) {
                        detectionQueue.push({
                            id: 'link_' + Date.now() + '_' + index,
                            url: line,
                            status: 'error',
                            error: 'æ— æ•ˆçš„URLæ ¼å¼',
                            createdAt: new Date().toISOString()
                        });
                        addLog(`æ— æ•ˆURLæ ¼å¼: ${line}`, 'error');
                        return;
                    }
                    
                    // æŸ¥æ‰¾åŒ¹é…çš„ç¾¤ç»„
                    let matchedGroup = null;
                    const fullUrl = url.href;
                    
                    for (const group of telegramGroups) {
                        if (!group.isActive) continue;
                        
                        // æ£€æŸ¥é“¾æ¥å…³é”®è¯åŒ¹é…
                        if (group.linkKeywords) {
                            const keywords = group.linkKeywords.split(',').map(k => k.trim());
                            const matchedKeyword = keywords.find(keyword => 
                                fullUrl.includes(keyword) || 
                                fullUrl.toLowerCase().includes(keyword.toLowerCase())
                            );
                            
                            if (matchedKeyword) {
                                matchedGroup = group;
                                break;
                            }
                        }
                        
                        // æ£€æŸ¥CIDå‚æ•°åŒ¹é…
                        if (group.cidParam) {
                            const searchParams = new URLSearchParams(url.search);
                            const cidValue = searchParams.get('cid');
                            
                            if (cidValue === group.cidParam) {
                                matchedGroup = group;
                                break;
                            }
                        }
                    }
                    
                    if (matchedGroup) {
                        detectionQueue.push({
                            id: 'link_' + Date.now() + '_' + index,
                            url: fullUrl,
                            originalUrl: line,
                            groupId: matchedGroup.id,
                            groupName: matchedGroup.name,
                            chatId: matchedGroup.chatId,
                            websiteUrl: matchedGroup.websiteUrl,
                            logoSelector: matchedGroup.logoSelector,
                            targetLogoText: matchedGroup.targetLogoText,
                            status: 'pending',
                            createdAt: new Date().toISOString(),
                            checked: false,
                            cid: (() => {
                                const searchParams = new URLSearchParams(url.search);
                                return searchParams.get('cid');
                            })()
                        });
                        addLog(`é“¾æ¥åŒ¹é…ç¾¤ç»„: ${matchedGroup.name}`, 'success');
                    } else {
                        detectionQueue.push({
                            id: 'link_' + Date.now() + '_' + index,
                            url: fullUrl,
                            originalUrl: line,
                            groupId: null,
                            groupName: 'æœªåŒ¹é…ç¾¤ç»„',
                            status: 'pending',
                            error: 'æœªæ‰¾åˆ°åŒ¹é…çš„ç¾¤ç»„é…ç½®',
                            createdAt: new Date().toISOString()
                        });
                        addLog(`æœªåŒ¹é…ç¾¤ç»„: ${line}`, 'warning');
                    }
                } catch (e) {
                    console.error('é“¾æ¥è§£æé”™è¯¯:', e);
                    detectionQueue.push({
                        id: 'link_' + Date.now() + '_' + index,
                        url: line,
                        groupId: null,
                        groupName: 'è§£æé”™è¯¯',
                        status: 'error',
                        error: e.message,
                        createdAt: new Date().toISOString()
                    });
                    addLog(`é“¾æ¥è§£æé”™è¯¯: ${e.message}`, 'error');
                }
            });
            
            updateCurrentStep(`å®Œæ•´é“¾æ¥è§£æå®Œæˆï¼Œå…± ${detectionQueue.length} ä¸ªé“¾æ¥`);
            
            updateQueueDisplay();
            updateStatusDisplay();
            showNotification(`å®Œæ•´é“¾æ¥è§£æå®Œæˆï¼Œå…± ${detectionQueue.length} ä¸ªé“¾æ¥`, 'success');
            addLog(`å®Œæ•´é“¾æ¥è§£æå®Œæˆï¼Œå…± ${detectionQueue.length} ä¸ªé“¾æ¥`, 'success');
        }

        async function startMultiCheck() {
            if (detectionQueue.length === 0) {
                showNotification('è¯·å…ˆè§£æé“¾æ¥', 'warning');
                return;
            }
            
            isChecking = true;
            currentDetectionIndex = 0;
            showNotification('å¼€å§‹æ‰¹é‡æ£€æµ‹å®Œæ•´é“¾æ¥', 'success');
            addLog('å¼€å§‹æ‰¹é‡æ£€æµ‹å®Œæ•´é“¾æ¥', 'info');
            
            await processDetectionQueue();
        }

        async function processDetectionQueue() {
            if (!isChecking || currentDetectionIndex >= detectionQueue.length) {
                isChecking = false;
                showNotification('æ‰¹é‡æ£€æµ‹å®Œæˆ', 'success');
                addLog('æ‰¹é‡æ£€æµ‹å®Œæˆ', 'success');
                return;
            }
            
            const link = detectionQueue[currentDetectionIndex];
            if (link.status !== 'pending' || !link.groupId) {
                currentDetectionIndex++;
                setTimeout(processDetectionQueue, 100);
                return;
            }
            
            const group = telegramGroups.find(g => g.id === link.groupId);
            if (!group) {
                link.status = 'error';
                link.error = 'ç¾¤ç»„ä¸å­˜åœ¨';
                currentDetectionIndex++;
                setTimeout(processDetectionQueue, 100);
                return;
            }
            
            // æ›´æ–°çŠ¶æ€
            link.status = 'checking';
            document.getElementById('currentLink').textContent = link.url;
            updateCurrentStep(`æ­£åœ¨æ£€æµ‹: ${group.name}`);
            updateQueueDisplay();
            
            // æ‰§è¡Œæ£€æµ‹æµç¨‹
            await executeFullLinkDetection(link, group);
            
            // æ›´æ–°è®¡æ•°å¹¶ç»§ç»­ä¸‹ä¸€ä¸ª
            currentDetectionIndex++;
            updateStatusDisplay();
            
            // å»¶è¿Ÿåç»§ç»­ä¸‹ä¸€ä¸ª
            setTimeout(processDetectionQueue, 5000);
        }

        function stopAllChecks() {
            isChecking = false;
            showNotification('å·²åœæ­¢æ‰€æœ‰æ£€æµ‹', 'warning');
            addLog('åœæ­¢æ‰€æœ‰æ£€æµ‹', 'warning');
        }

        function updateCurrentStep(text) {
            const stepElement = document.getElementById('currentStep');
            if (stepElement) {
                const span = stepElement.querySelector('span');
                if (span) {
                    span.textContent = text;
                }
            }
        }

        function updateQueueDisplay() {
            const container = document.getElementById('detectionQueue');
            if (!container) return;
            
            if (detectionQueue.length === 0) {
                container.innerHTML = '<div class="text-center text-muted py-20">ç­‰å¾…è§£æé“¾æ¥...</div>';
                return;
            }
            
            let html = '';
            detectionQueue.forEach(link => {
                const group = telegramGroups.find(g => g.id === link.groupId);
                const groupName = group ? group.name : link.groupName;
                
                html += `
                    <div class="link-item ${link.status === 'matched' ? 'matched' : link.status === 'error' ? 'error' : ''}">
                        <i class="fas fa-link"></i>
                        <div class="link-text">
                            <div>${link.url}</div>
                            <small class="text-muted">
                                ç¾¤ç»„: ${groupName} | 
                                ${link.cid ? `CID: ${link.cid} | ` : ''}
                                çŠ¶æ€: ${link.status}
                            </small>
                        </div>
                        <span class="status-badge status-${link.status}">${link.status}</span>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function updateStatusDisplay() {
            const pendingCount = detectionQueue.filter(l => l.status === 'pending').length;
            document.getElementById('pendingCount').textContent = pendingCount;
            
            const total = detectionQueue.length;
            const completed = total - pendingCount;
            const percent = total > 0 ? Math.round((completed / total) * 100) : 0;
            document.getElementById('progressPercent').textContent = percent + '%';
        }

        // è‡ªåŠ¨åŒ–æ£€æµ‹å‡½æ•°
        function startAllAutoDetection() {
            isAutoDetecting = true;
            showNotification('å¯åŠ¨å…¨è‡ªåŠ¨æ£€æµ‹', 'success');
            addLog('å¯åŠ¨å…¨è‡ªåŠ¨æ£€æµ‹', 'info');
            
            telegramGroups.forEach(group => {
                if (group.isActive) {
                    startAutoDetectionForGroup(group.id);
                }
            });
        }

        function stopAllAutoDetection() {
            isAutoDetecting = false;
            
            Object.values(autoDetectionTimers).forEach(timer => {
                clearInterval(timer);
            });
            
            autoDetectionTimers = {};
            showNotification('å·²åœæ­¢æ‰€æœ‰æ£€æµ‹', 'warning');
            addLog('åœæ­¢æ‰€æœ‰æ£€æµ‹', 'warning');
        }

        function startAutoDetectionForGroup(groupId) {
            const group = telegramGroups.find(g => g.id === groupId);
            if (!group || !group.isActive) return;
            
            // æ¸…é™¤ç°æœ‰å®šæ—¶å™¨
            if (autoDetectionTimers[groupId]) {
                clearInterval(autoDetectionTimers[groupId]);
            }
            
            // ç«‹å³æ‰§è¡Œä¸€æ¬¡
            startEnhancedAutoDetection(groupId);
            
            // è®¾ç½®å®šæ—¶å™¨
            const interval = (group.checkInterval || 30) * 60 * 1000;
            autoDetectionTimers[groupId] = setInterval(() => {
                if (isAutoDetecting && group.isActive) {
                    startEnhancedAutoDetection(groupId);
                }
            }, interval);
            
            showNotification(`å·²å¯åŠ¨ ${group.name} çš„è‡ªåŠ¨æ£€æµ‹`, 'success');
            addLog(`å¯åŠ¨è‡ªåŠ¨æ£€æµ‹: ${group.name}`, 'info');
        }

        async function startEnhancedAutoDetection(groupId) {
            const group = telegramGroups.find(g => g.id === groupId);
            if (!group) return;
            
            currentDetectingGroup = group;
            
            try {
                // æ­¥éª¤1: æ‰“å¼€ä»£ç†æµè§ˆå™¨
                updateAutoStep(1, 'æ­£åœ¨æ‰“å¼€ä»£ç†æµè§ˆå™¨...');
                createProxyBrowser(groupId, group.websiteUrl + (group.cidParam ? `?cid=${group.cidParam}` : ''));
                await sleep(3000);
                updateAutoStep(1, 'ä»£ç†æµè§ˆå™¨æ‰“å¼€å®Œæˆ', true);
                
                // æ­¥éª¤2: æ¨¡æ‹Ÿç‚¹å‡»Logo
                updateAutoStep(2, 'æ­£åœ¨æ¨¡æ‹Ÿç‚¹å‡»Logo...');
                simulateLogoClick(groupId);
                await sleep(2000);
                updateAutoStep(2, 'Logoç‚¹å‡»æ¨¡æ‹Ÿå®Œæˆ', true);
                
                // æ­¥éª¤3: æ£€æŸ¥å¾…æ£€æµ‹é“¾æ¥
                updateAutoStep(3, 'æ£€æŸ¥å¾…æ£€æµ‹é“¾æ¥...');
                
                // æŸ¥æ‰¾è¯¥ç¾¤ç»„çš„å¾…æ£€æµ‹é“¾æ¥
                const pendingLinks = detectionQueue.filter(link => 
                    link.groupId === groupId && link.status === 'pending'
                );
                
                if (pendingLinks.length > 0) {
                    updateAutoStep(3, `å‘ç°${pendingLinks.length}ä¸ªå¾…æ£€æµ‹é“¾æ¥`, true);
                    
                    // æµ‹è¯•ç¬¬ä¸€ä¸ªé“¾æ¥
                    const testLink = pendingLinks[0];
                    
                    // æ­¥éª¤4: æ˜¾ç¤ºå®Œæ•´é“¾æ¥
                    updateAutoStep(4, 'æ˜¾ç¤ºå®Œæ•´é“¾æ¥å†…å®¹...');
                    simulateFullLinkShow(groupId, testLink.cid || group.cidParam || '7890');
                    await sleep(2000);
                    updateAutoStep(4, 'å®Œæ•´é“¾æ¥æ˜¾ç¤ºå®Œæˆ', true);
                    
                    // æ­¥éª¤5: æˆªå›¾å¹¶å‘é€
                    updateAutoStep(5, 'æˆªå›¾å¹¶å‘é€...');
                    const screenshot = await captureProxyScreenshot(groupId);
                    
                    if (screenshot) {
                        // æ›´æ–°çŠ¶æ€
                        testLink.status = 'matched';
                        testLink.matchedAt = new Date().toISOString();
                        testLink.screenshot = screenshot.substring(0, 100) + '...';
                        
                        group.status = 'matched';
                        group.matchCount = (group.matchCount || 0) + 1;
                        group.lastDetected = new Date().toISOString();
                        
                        // å‘é€åˆ°Telegram
                        if (botConfig.token && botConfig.sendScreenshot) {
                            await sendToTelegram(group, testLink, screenshot);
                            testLink.status = 'sent';
                            group.status = 'sent';
                            group.sentCount = (group.sentCount || 0) + 1;
                        }
                        
                        // ä¿å­˜ç»“æœ
                        const result = {
                            id: 'result_' + Date.now(),
                            groupId: group.id,
                            groupName: group.name,
                            linkId: testLink.id,
                            linkUrl: testLink.url,
                            originalUrl: testLink.originalUrl,
                            cid: testLink.cid,
                            status: testLink.status,
                            timestamp: new Date().toISOString(),
                            screenshot: testLink.screenshot
                        };
                        checkResults.unshift(result);
                        
                        // æ›´æ–°ç»Ÿè®¡
                        stats.totalDetected++;
                        stats.matchedCount++;
                        if (testLink.status === 'sent') stats.sentCount++;
                        
                        saveAllData();
                        updateGroupsDisplay();
                        updateQueueDisplay();
                        updateStatsDisplay();
                        updateResultsDisplay();
                        
                        updateAutoStep(5, 'æˆªå›¾å‘é€å®Œæˆ', true);
                        showNotification(`è‡ªåŠ¨æ£€æµ‹å®Œæˆ: ${group.name}`, 'success');
                        addLog(`è‡ªåŠ¨æ£€æµ‹å®Œæˆ: ${group.name}`, 'success');
                    } else {
                        updateAutoStep(5, 'æˆªå›¾å¤±è´¥', false);
                    }
                } else {
                    updateAutoStep(3, 'æ— å¾…æ£€æµ‹é“¾æ¥', false);
                    updateAutoStep(4, 'è·³è¿‡', false);
                    updateAutoStep(5, 'è·³è¿‡', false);
                }
                
                // å…³é—­æµè§ˆå™¨
                setTimeout(() => {
                    closeProxyBrowser(groupId);
                }, 2000);
                
            } catch (error) {
                console.error('å¢å¼ºæ£€æµ‹å¤±è´¥:', error);
                updateAutoStep(5, 'æ£€æµ‹å¤±è´¥', false);
                showNotification(`æ£€æµ‹å¤±è´¥: ${group.name}`, 'error');
                addLog(`å¢å¼ºæ£€æµ‹å¤±è´¥: ${group.name}`, 'error');
                
                // å…³é—­æµè§ˆå™¨
                closeProxyBrowser(groupId);
                updateGroupsDisplay();
            }
        }

        function updateAutoStep(step, text, success = null) {
            const stepElement = document.getElementById(`autoStep${step}`);
            if (!stepElement) return;
            
            const icon = stepElement.querySelector('i');
            const textSpan = stepElement.querySelector('span');
            
            if (success === null) {
                stepElement.className = 'step-indicator active';
            } else if (success) {
                stepElement.className = 'step-indicator completed';
            } else {
                stepElement.className = 'step-indicator';
            }
            
            if (icon) {
                if (success === null) {
                    icon.className = 'fas fa-circle-notch fa-spin';
                } else if (success) {
                    icon.className = 'fas fa-check-circle';
                } else {
                    icon.className = 'fas fa-times-circle';
                }
            }
            
            if (textSpan) {
                textSpan.textContent = text;
            }
        }

        // Telegramå‘é€å‡½æ•°
        async function sendToTelegram(group, link, screenshotData) {
            if (!botConfig.token || !botConfig.sendScreenshot) return;
            
            try {
                const apiUrl = `${botConfig.apiServer}/bot${botConfig.token}`;
                
                // åˆ›å»ºæ¶ˆæ¯æ–‡æœ¬
                let caption = `âœ… å®Œæ•´é“¾æ¥æ£€æµ‹æˆåŠŸ\n\n`;
                caption += `ğŸ“‹ ç¾¤ç»„: ${group.name}\n`;
                caption += `ğŸ”— å®Œæ•´é“¾æ¥: ${link.url}\n`;
                if (link.cid) {
                    caption += `ğŸ¯ CIDå‚æ•°: ${link.cid}\n`;
                }
                caption += `ğŸ“… æ£€æµ‹æ—¶é—´: ${new Date().toLocaleString('zh-CN')}\n`;
                caption += `ğŸ”„ çŠ¶æ€: åŒ¹é…æˆåŠŸå¹¶å·²æˆªå›¾\n\n`;
                caption += `#å®Œæ•´é“¾æ¥æ£€æµ‹ #è‡ªåŠ¨æˆªå›¾`;
                
                // è½¬æ¢DataURLä¸ºBlob
                const blob = await dataURLToBlob(screenshotData);
                
                const formData = new FormData();
                formData.append('chat_id', group.chatId);
                formData.append('photo', blob, `screenshot_${Date.now()}.png`);
                formData.append('caption', caption.substring(0, 1024));
                formData.append('parse_mode', 'Markdown');
                
                const response = await fetch(`${apiUrl}/sendPhoto`, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (!result.ok) {
                    throw new Error(result.description || 'å‘é€å¤±è´¥');
                }
                
                updateActionStep(`æˆªå›¾å·²å‘é€åˆ°Telegramç¾¤ç»„: ${group.name}`, 'success');
                return result;
                
            } catch (error) {
                console.error('å‘é€åˆ°Telegramå¤±è´¥:', error);
                updateActionStep(`å‘é€å¤±è´¥: ${error.message}`, 'error');
                throw error;
            }
        }

        function dataURLToBlob(dataURL) {
            return new Promise((resolve, reject) => {
                try {
                    const arr = dataURL.split(',');
                    const mimeMatch = arr[0].match(/:(.*?);/);
                    const mime = mimeMatch ? mimeMatch[1] : 'image/png';
                    const bstr = atob(arr[1]);
                    let n = bstr.length;
                    const u8arr = new Uint8Array(n);
                    
                    while (n--) {
                        u8arr[n] = bstr.charCodeAt(n);
                    }
                    
                    resolve(new Blob([u8arr], { type: mime }));
                } catch (error) {
                    console.error('DataURLè½¬Blobå¤±è´¥:', error);
                    
                    // åˆ›å»ºå¤‡ç”¨å›¾ç‰‡
                    const canvas = document.createElement('canvas');
                    canvas.width = 400;
                    canvas.height = 200;
                    const ctx = canvas.getContext('2d');
                    
                    ctx.fillStyle = '#f8f9fa';
                    ctx.fillRect(0, 0, 400, 200);
                    
                    ctx.fillStyle = '#ef4444';
                    ctx.font = 'bold 16px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('æˆªå›¾ç”Ÿæˆå¤±è´¥', 200, 80);
                    ctx.fillText('è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥', 200, 110);
                    
                    canvas.toBlob(resolve, 'image/png', 0.8);
                }
            });
        }

        // æµ‹è¯•å•é“¾æ¥
        function testSingleLink(groupId) {
            const group = telegramGroups.find(g => g.id === groupId);
            if (!group) return;
            
            // åˆ›å»ºæµ‹è¯•é“¾æ¥
            const testLink = {
                id: 'test_link_' + Date.now(),
                url: `${group.websiteUrl}?cid=${group.cidParam || 7890}&test=true`,
                originalUrl: `${group.websiteUrl}?cid=${group.cidParam || 7890}&test=true`,
                groupId: group.id,
                groupName: group.name,
                status: 'pending',
                cid: group.cidParam || '7890'
            };
            
            detectionQueue.push(testLink);
            updateQueueDisplay();
            
            showNotification(`æµ‹è¯•é“¾æ¥å·²æ·»åŠ åˆ°é˜Ÿåˆ—: ${group.name}`, 'info');
            addLog(`æ·»åŠ æµ‹è¯•é“¾æ¥: ${group.name}`, 'info');
        }

        // åˆå§‹åŒ–ç³»ç»Ÿ
        document.addEventListener('DOMContentLoaded', function() {
            loadAllData();
            updateStatsDisplay();
            
            if (telegramGroups.length === 0) {
                loadExampleGroups();
            }
            
            console.log('å¢å¼ºç‰ˆç³»ç»Ÿåˆå§‹åŒ–å®Œæˆï¼Œå·²åŠ è½½ç¾¤ç»„:', telegramGroups.length);
            addLog('å¢å¼ºç‰ˆç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ', 'info');
        });

        window.onload = function() {
            console.log('å…¨è‡ªåŠ¨ç³»ç»Ÿå·²å‡†å¤‡å°±ç»ª');
            setTimeout(() => {
                showNotification('å…¨è‡ªåŠ¨ç¾¤ç»„é“¾æ¥æ£€æµ‹ç³»ç»Ÿ - å¢å¼ºç‰ˆå·²å°±ç»ªï¼', 'info');
                addLog('ç³»ç»Ÿå·²å®Œå…¨åŠ è½½ï¼Œå¯ä»¥ä½¿ç”¨ä»£ç†æµè§ˆå™¨è¿›è¡Œè‡ªåŠ¨åŒ–æ£€æµ‹', 'info');
            }, 1000);
        };

        // æµ‹è¯•OCRåŠŸèƒ½
        async function testOCRWithProxy() {
            updateActionStep('å¼€å§‹æµ‹è¯•OCRè¯†åˆ«...', 'info');
            
            try {
                // åˆå§‹åŒ–Tesseract
                if (!ocrWorker) {
                    ocrWorker = await Tesseract.createWorker();
                    await ocrWorker.loadLanguage('eng+chi_sim');
                    await ocrWorker.initialize('eng+chi_sim');
                }
                
                // åˆ›å»ºæµ‹è¯•å›¾ç‰‡è¿›è¡ŒOCRè¯†åˆ«
                const canvas = document.createElement('canvas');
                canvas.width = 600;
                canvas.height = 200;
                const ctx = canvas.getContext('2d');
                
                // ç»˜åˆ¶æµ‹è¯•æ–‡å­—
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, 600, 200);
                
                ctx.fillStyle = '#000000';
                ctx.font = 'bold 32px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('æ¾³é—¨æ–°è‘¡äº¬', 300, 60);
                ctx.fillText('505.com', 300, 120);
                ctx.font = '20px Arial';
                ctx.fillText('Telegram Group Link Detection', 300, 160);
                
                const testImage = canvas.toDataURL('image/png', 0.9);
                
                // æ‰§è¡ŒOCRè¯†åˆ«
                const { data: { text, confidence } } = await ocrWorker.recognize(testImage);
                
                updateActionStep(`OCRè¯†åˆ«å®Œæˆï¼Œç½®ä¿¡åº¦: ${confidence.toFixed(2)}%`, 'success');
                updateActionStep(`è¯†åˆ«æ–‡å­—: ${text.substring(0, 50)}...`, 'info');
                
                // æ£€æŸ¥æ˜¯å¦åŒ…å«ç›®æ ‡å…³é”®è¯
                const keywords = ['æ¾³é—¨æ–°è‘¡äº¬', '505.com', 'Telegram'];
                const foundKeywords = keywords.filter(keyword => 
                    text.includes(keyword)
                );
                
                if (foundKeywords.length > 0) {
                    updateActionStep(`å‘ç°å…³é”®è¯: ${foundKeywords.join(', ')}`, 'success');
                }
                
            } catch (error) {
                console.error('OCRæµ‹è¯•å¤±è´¥:', error);
                updateActionStep(`OCRæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>
